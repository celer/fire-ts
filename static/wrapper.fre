function template(<FTSP>i,<FTSP>o,<FTSP>oc){
	<FTSP>o=<FTSP>o||{};
	<FTSP>o.b=<FTSP>o.blocks||{};
	var <FTSP>s="";
	var <FTSP>e=(<FTSP>o.e||function(i){<FTSP>s+=i;});
	var <FTSP>j=(<FTSP>o.j||JSON.stringify);
	var <FTSP>r=<FTSP>o.render;
  <% if(async){ %>
		var d=<%# deps %>;
		var ts={};
		var <FTSP>r = function(t,i,o){
			return <FTSP>s+=(ts[t+"-"+j(i)]);
		}
		var td = function(){
			if(d.length>0){
				var tn=d.shift();
				o.f(tn,function(err,res){
					if(err) {
						return <FTSP>oc(err);
					} else { 
						eval("var k="+res);
						k(i,o,function(err,res){
							if(err) return <FTSP>oc(err);
							ts[tn+"-"+j(i)]=res;
							td();
						});
					}
				});
			} else {
				console.log("Attempting to render template");
				with(<FTSP>i){
					<%=code%>	
				}
				return <FTSP>oc(null,s);
			}
		}
		td();
	<% } else { %>
		with(<FTSP>i){
			<%=code%>	
		}
		return <FTSP>s;
	<% } %>
}
